{% extends "base.html" %}
{% block content %}
<h2 class="mb-3">My Gallery</h2>

<form method="get" action="{{ url_for('upload.gallery') }}" class="card mb-3 p-3">
  <div class="row g-2 align-items-end">
    <div class="col-sm-3">
      <label class="form-label">Sort By</label>
      <select name="sort" class="form-select">
        <option value="date_desc" {% if sort_option=='date_desc' %}selected{% endif %}>Newest First</option>
        <option value="date_asc" {% if sort_option=='date_asc' %}selected{% endif %}>Oldest First</option>
        <option value="score_desc" {% if sort_option=='score_desc' %}selected{% endif %}>Score: High to Low</option>
        <option value="score_asc" {% if sort_option=='score_asc' %}selected{% endif %}>Score: Low to High</option>
      </select>
    </div>
    <div class="col-sm-3">
      <label class="form-label">Minimum Score</label>
      <input type="number" step="0.01" min="0" max="1" name="min_score" value="{{ min_score }}" class="form-control" />
    </div>
    <div class="col-sm-3">
      <label class="form-label">Date Range</label>
      <select name="date_range" class="form-select">
        <option value="all" {% if date_range=='all' %}selected{% endif %}>All Time</option>
        <option value="today" {% if date_range=='today' %}selected{% endif %}>Today</option>
        <option value="week" {% if date_range=='week' %}selected{% endif %}>Last 7 Days</option>
        <option value="month" {% if date_range=='month' %}selected{% endif %}>Last 30 Days</option>
      </select>
    </div>
    <div class="col-sm-3">
      <label class="form-label">View</label>
      <select name="view" class="form-select">
        <option value="grid" {% if view_option=='grid' %}selected{% endif %}>Grid</option>
        <option value="list" {% if view_option=='list' %}selected{% endif %}>List</option>
      </select>
    </div>
  </div>
  <div class="mt-3">
    <button class="btn btn-primary">Apply</button>
  </div>
</form>

{% if frames %}
  {% if view_option == 'list' %}
    <div class="list-group mb-3">
      {% for frame in frames %}
        <div class="list-group-item d-flex align-items-center">
          <img src="{{ url_for('static', filename=(frame.frame_path or '').replace('\\','/')) }}" class="rounded me-3" style="width: 100px; height: auto;" alt="Frame">
          <div class="flex-fill">
            <div>
              <strong>Score:</strong> {{ '%.3f'|format(frame.score or 0) }}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="row g-2 mb-3">
      {% for frame in frames %}
        <div class="col-6 col-md-3 col-lg-2">
          <div class="card">
            <img class="card-img-top" src="{{ url_for('static', filename=(frame.frame_path or '').replace('\\','/')) }}" alt="Frame">
            <div class="card-body p-2">
              <small class="text-muted">{{ '%.2f'|format(frame.score or 0) }}</small>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  {% if pagination and (pagination.has_prev or pagination.has_next) %}
    <nav aria-label="Gallery pagination">
      <ul class="pagination">
        <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
          <a class="page-link" href="{{ url_for('upload.gallery', page=pagination.prev_page, per_page=pagination.per_page, sort=sort_option, min_score=min_score, view=view_option, date_range=date_range) }}">Previous</a>
        </li>
        <li class="page-item disabled"><span class="page-link">Page {{ pagination.page }} of {{ pagination.total_pages }}</span></li>
        <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
          <a class="page-link" href="{{ url_for('upload.gallery', page=pagination.next_page, per_page=pagination.per_page, sort=sort_option, min_score=min_score, view=view_option, date_range=date_range) }}">Next</a>
        </li>
      </ul>
    </nav>
  {% endif %}
{% else %}
  <div class="alert alert-info">No photos found for the selected filters.</div>
{% endif %}
{% endblock %}
