{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="col-lg-7">
    <h2 class="mb-3">Upload Surf Video</h2>
    <form method="post" action="{{ url_for('upload.video_upload') }}" enctype="multipart/form-data" class="card p-3">
      {{ form.hidden_tag() }}

      <div class="mb-3">
        <label class="form-label">{{ form.video_file.label }}</label>
        {{ form.video_file(class_='form-control', accept='video/*') }}
        {% if form.video_file.description %}
          <div class="form-text">{{ form.video_file.description }}</div>
        {% endif %}
        {% for error in form.video_file.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>

      <div class="mb-3">
        <label class="form-label">{{ form.location.label }}</label>
        {{ form.location(class_='form-control', placeholder='e.g., Pipeline, North Shore') }}
        {% if form.location.description %}
          <div class="form-text">{{ form.location.description }}</div>
        {% endif %}
        {% for error in form.location.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>

      <div class="mb-3">
        <label class="form-label">{{ form.description.label }}</label>
        {{ form.description(class_='form-control', rows=3) }}
        {% if form.description.description %}
          <div class="form-text">{{ form.description.description }}</div>
        {% endif %}
        {% for error in form.description.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>

      <div>
        {{ form.submit(class_='btn btn-primary') }}
        <a href="{{ url_for('upload.gallery') }}" class="btn btn-outline-secondary">Go to Gallery</a>
      </div>
    </form>
  </div>

  <div class="col-lg-5">
    <h4 class="mb-3">Recent Videos</h4>
    {% if videos %}
      <div class="list-group">
        {% for video in videos %}
          <div class="list-group-item">
            <div class="d-flex">
              {% if video.thumbnail_path %}
                <img src="{{ url_for('static', filename=(video.thumbnail_path | replace('\\','/')) ) }}" class="rounded me-3" style="width: 120px; height: auto;" alt="Thumbnail">
              {% else %}
                <div class="bg-light border me-3 d-flex align-items-center justify-content-center" style="width: 120px; height: 68px;">No thumbnail</div>
              {% endif %}
              <div class="flex-fill">
                <div class="d-flex justify-content-between">
                  <strong>{{ video.location or 'Unnamed Beach' }}</strong>
                  <small class="text-muted">{{ (video.created_at or '').strftime('%Y-%m-%d %H:%M') if video.created_at else '' }}</small>
                </div>
                <div class="my-1">
                  {% if video.status == 'pending' %}
                    <span class="badge bg-secondary">Pending</span>
                  {% elif video.status == 'processing' %}
                    <span class="badge bg-primary">Processing</span>
                  {% elif video.status == 'completed' %}
                    <span class="badge bg-success">Completed</span>
                  {% else %}
                    <span class="badge bg-danger">Failed</span>
                  {% endif %}
                </div>
                <div class="d-flex gap-2">
                  <a class="btn btn-sm btn-outline-primary" href="{{ url_for('upload.video_status', video_id=video.id) }}">Status</a>
                  {% if video.status == 'pending' %}
                    <a class="btn btn-sm btn-primary" href="{{ url_for('upload.process_video_route', video_id=video.id) }}">Start Processing</a>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="alert alert-info">No videos uploaded yet.</div>
    {% endif %}
  </div>
</div>
{% endblock %}
